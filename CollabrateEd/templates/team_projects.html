{% extends "base.html" %}
{% block content %}

<h4 class="mb-4">Team Projects</h4>

<form method="POST" class="input-group mb-4">
  <input name="name" class="form-control" placeholder="New team project name" required>
  <button class="btn btn-primary">Create</button>
</form>

{% for project in team_projects %}
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">{{ project.name }}</h5>

      <form method="POST" action="/tasks/{{ project.id }}">
        <input type="text" name="title" placeholder="Task title" class="form-control mb-2" required>
        <input type="date" name="due_date" class="form-control mb-2">
        <button type="submit" class="btn btn-primary">Add Task</button>
      </form>

      <ul class="list-group mb-3">
        {% for task in project.tasks %}
          <li class="list-group-item d-flex justify-content-between align-items-start flex-column">
            <div class="w-100">
              <strong>{{ task.title }}</strong>
              {% if task.due_date %}
                <span class="badge bg-warning text-dark ms-2">Due: {{ task.due_date.strftime('%Y-%m-%d') }}</span>
              {% endif %}
              {% if task.submitted %}
                <span class="badge bg-success ms-2">
                  Submitted by {{ task.submitter_user.username }} on {{ task.submitted_at.strftime('%Y-%m-%d') }}
                </span>
              {% else %}
                <span class="badge bg-danger ms-2">Not Submitted</span>
              {% endif %}
            </div>
            {% if not task.submitted %}
              <form method="POST" action="/submit-task/{{ task.id }}" class="mt-2">
                <button class="btn btn-outline-success btn-sm">Mark as Submitted</button>
              </form>
            {% endif %}
          </li>
        {% else %}
          <li class="list-group-item text-muted">No tasks yet.</li>
        {% endfor %}
      </ul>

      <form method="POST" action="{{ url_for('upload_team_note', project_id=project.id) }}" enctype="multipart/form-data" class="mb-3">
        <label class="form-label">ðŸ“Ž Add your files here (PDF/DOC)</label>
        <div class="input-group">
          <input type="file" name="file" class="form-control" required>
          <button class="btn btn-outline-secondary" type="submit">Upload</button>
        </div>
      </form>

      <h6>Shared Notes</h6>
      <ul class="list-group mb-3">
        {% for note in project.notes %}
          <li class="list-group-item">
            <a href="{{ url_for('uploaded_file', filename=note.filename) }}" target="_blank">{{ note.filename }}</a>
          </li>
        {% else %}
          <li class="list-group-item text-muted">No notes uploaded yet.</li>
        {% endfor %}
      </ul>

      {% if project.is_team %}
        <a href="{{ url_for('chat', project_id=project.id) }}" class="btn btn-sm btn-outline-primary">Open Chat</a>
      {% else %}
        <div class="text-muted">Chat is only available for team projects.</div>
      {% endif %}
    </div>
  </div>
{% else %}
  <p class="text-muted">No team projects yet. Create one above!</p>
{% endfor %}

{% endblock %}